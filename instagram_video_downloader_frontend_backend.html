<!--
Full single-file deliverable: frontend HTML + backend Node.js example.
Save the first section as `index.html` and the backend section as `server.js`.

LEGAL: Downloading videos may violate Instagram's Terms of Service and/or copyright.
Use only for content you own or have permission to download. For production use, prefer
Instagram Graph API or oEmbed with proper access tokens.
-->

<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Instagram Video Downloader — Deep Story</title>
  <!-- Tailwind CDN for quick styling -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-slate-50 flex items-center justify-center p-6">
  <div class="w-full max-w-2xl bg-white rounded-2xl shadow p-6">
    <h1 class="text-2xl font-semibold mb-2">Instagram Video Downloader</h1>
    <p class="text-sm text-slate-500 mb-4">Instagram ka public post link daalein (sirf public posts). Backend chahiye to server run karein.</p>

    <form id="form" class="flex gap-2">
      <input id="url" type="url" required placeholder="https://www.instagram.com/p/XXXXXXXX/" class="flex-1 p-3 border rounded-md" />
      <button class="px-4 py-2 bg-indigo-600 text-white rounded-md" type="submit">Fetch</button>
    </form>

    <div id="result" class="mt-6 hidden">
      <div id="preview" class="mb-4"></div>
      <a id="downloadBtn" class="inline-block px-4 py-2 bg-green-600 text-white rounded-md" download>Download Video</a>
    </div>

    <div id="error" class="mt-4 text-sm text-red-600 hidden"></div>

    <hr class="my-6" />
    <details class="text-sm text-slate-600">
      <summary class="cursor-pointer font-medium">How to use (Developer)</summary>
      <div class="mt-3">
        <ol class="list-decimal pl-5 space-y-1">
          <li>Run a backend that exposes <code>/api/fetch?url={INSTAGRAM_POST_URL}</code>.</li>
          <li>Backend should fetch the Instagram page server-side and extract the <code>og:video</code> meta tag or the video URL from JSON embedded in the page.</li>
          <li>Frontend calls this endpoint and receives <code>{ video: "https://...mp4" }</code>.</li>
        </ol>
      </div>
    </details>

    <details class="text-sm text-slate-600 mt-3">
      <summary class="cursor-pointer font-medium">Legal / Notes</summary>
      <div class="mt-3">
        <ul class="list-disc pl-5 space-y-1">
          <li>Respect copyright and Instagram Terms of Service.</li>
          <li>Public posts only — private posts cannot be fetched without account access.</li>
          <li>For production use, implement rate-limiting, caching and use official APIs where possible.</li>
        </ul>
      </div>
    </details>
  </div>

<script>
const form = document.getElementById('form');
const urlInput = document.getElementById('url');
const result = document.getElementById('result');
const preview = document.getElementById('preview');
const downloadBtn = document.getElementById('downloadBtn');
const errorBox = document.getElementById('error');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  result.classList.add('hidden');
  errorBox.classList.add('hidden');
  preview.innerHTML = '';

  const postUrl = urlInput.value.trim();
  if (!postUrl) return;

  try {
    // Call your backend. Change /api/fetch to your server URL if different.
    const resp = await fetch('/api/fetch?url=' + encodeURIComponent(postUrl));
    if (!resp.ok) throw new Error('Server error ' + resp.status);
    const data = await resp.json();

    if (data && data.video) {
      // Show preview
      preview.innerHTML = `<video controls class=\"max-w-full rounded\"><source src=\"${data.video}\"></video>`;
      downloadBtn.href = data.video;
      downloadBtn.setAttribute('download', 'instagram-video.mp4');
      result.classList.remove('hidden');
    } else {
      throw new Error(data.error || 'Video not found');
    }
  } catch (err) {
    errorBox.textContent = err.message;
    errorBox.classList.remove('hidden');
  }
});
</script>

<!--
--------------------
Backend example (save as server.js)
Run: npm init -y && npm i express node-fetch cheerio cors
Then: node server.js
This is a very basic example — improve error handling and add caching & rate-limiting for production.
--------------------
-->

<!--
// server.js
const express = require('express');
const fetch = require('node-fetch');
const cheerio = require('cheerio');
const cors = require('cors');

const app = express();
app.use(cors());
app.use(express.json());

// Simple endpoint to fetch the OG video URL from an Instagram post page
app.get('/api/fetch', async (req, res) => {
  const postUrl = req.query.url;
  if (!postUrl) return res.status(400).json({ error: 'Missing url parameter' });

  try {
    // Fetch the Instagram page server-side to avoid CORS and get full HTML
    const r = await fetch(postUrl, {
      headers: {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0 Safari/537.36'
      }
    });

    if (!r.ok) return res.status(502).json({ error: 'Failed to fetch Instagram' });
    const html = await r.text();

    // Parse HTML and look for og:video meta tag
    const $ = cheerio.load(html);
    let video = $('meta[property="og:video"]').attr('content');

    // Fallback: look for JSON script containing 'video_url'
    if (!video) {
      const scripts = $('script[type="text/javascript"]').toArray().map(s => $(s).html());
      for (const s of scripts) {
        if (!s) continue;
        const idx = s.indexOf('video_url');
        if (idx !== -1) {
          // crude extraction
          const m = s.match(/"video_url":"(https?:\\/\\/[^"\\]+)"/);
          if (m) {
            video = m[1].replace(/\\\//g, '/');
            break;
          }
        }
      }
    }

    if (video) return res.json({ video });
    return res.status(404).json({ error: 'Video URL not found (maybe private or changed page structure)' });

  } catch (err) {
    console.error(err);
    return res.status(500).json({ error: 'Internal server error' });
  }
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => console.log('Server running on port', PORT));
-->

</body>
</html>
